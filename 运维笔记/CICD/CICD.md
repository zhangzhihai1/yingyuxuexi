[TOC]

# 1.devopsç®€ä»‹

æ•æ·å¼€å‘ï¼š

è¿­ä»£å¼€å‘ï¼Œå¢é‡å¼€å‘

ä¼˜åŠ¿ 

å°½æ—©äº¤ä»˜,åŠ å¿«èµ„é‡‘å›ç¬¼ 

é™çº§é£é™©,åŠæ—¶äº†è§£å¸‚åœºéœ€æ±‚ï¼ŒåŠæ—¶è·å–é—®é¢˜åé¦ˆ 

æé«˜æ•ˆç‡,é˜¶æ®µæ€§åŠŸèƒ½æ‹†åˆ†åŠå¿«é€Ÿè´¨é‡åé¦ˆ

**ä»€ä¹ˆæ˜¯ DevOps**

DevOpsæ˜¯ä¸€ç»„è¿‡ç¨‹ã€æ–¹æ³•ä¸ç³»ç»Ÿçš„ç»Ÿç§°ï¼Œç”¨äºä¿ƒè¿›å¼€å‘ã€æŠ€æœ¯è¿è¥å’Œè´¨é‡ä¿éšœï¼ˆQAï¼‰éƒ¨é—¨ä¹‹é—´çš„æ²Ÿ é€šã€åä½œä¸æ•´åˆã€‚ 

DevOps æ˜¯é’ˆå¯¹å¼€å‘äººå‘˜ã€è¿ç»´äººå‘˜å’Œæµ‹è¯•äººå‘˜çš„ä¸€ç§å·¥ä½œç†å¿µï¼Œæ˜¯è½¯ä»¶åœ¨åº”ç”¨å¼€å‘ã€ä»£ç éƒ¨ç½²å’Œè´¨é‡ æµ‹è¯•ç­‰æ•´æ¡ç”Ÿå‘½å‘¨æœŸä¸­åä½œå’Œæ²Ÿé€šçš„æœ€ä½³å®è·µ 

DevOps å¼ºè°ƒæ•´ä¸ªç»„ç»‡çš„æ‰€æœ‰ç›¸å…³éƒ¨é—¨çš„ç´§å¯†åˆä½œä»¥åŠäº¤ä»˜å’ŒåŸºç¡€è®¾æ–½å˜æ›´çš„è‡ªåŠ¨åŒ–ã€ä»è€Œå®ç°æŒç»­é›† æˆã€æŒç»­éƒ¨ç½²å’ŒæŒç»­äº¤ä»˜çš„ç›®æ ‡

**æŒç»­é›†æˆã€æŒç»­äº¤ä»˜å’ŒæŒç»­éƒ¨ç½² CICD**

æŒç»­é›†æˆï¼ˆContinuous Integrationï¼‰ã€æŒç»­äº¤ä»˜ï¼ˆContinuous  Deliveryï¼‰ ã€æŒç»­éƒ¨ç½²ï¼ˆContinuous Deploymentï¼‰

é›†æˆæŒ‡å°†å¤šä½å¼€å‘è€…çš„å¼€å‘ä»£ç æäº¤å,åˆå¹¶é›†æˆåœ¨ä¸€èµ·,å­˜æ”¾åœ¨ä»£ç åº“çš„è¿‡ç¨‹,å¹¶ä¸”åç»­è¿˜ä¼šä¸æ–­çš„è¿­ä»£ æ›´æ–°ä»£ç 

æŒç»­äº¤ä»˜çš„ç›®æ ‡æ˜¯æ‹¥æœ‰ä¸€ä¸ªå¯éš æ—¶éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒçš„ä»£ç åº“ã€‚

æŒç»­éƒ¨ç½²å¯ä»¥è‡ªåŠ¨å°†åº”ç”¨å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒã€‚

**è“ç»¿éƒ¨ç½² Blue-green Deployments**

è“ç»¿éƒ¨ç½²æŒ‡çš„æ˜¯ä¸åœæ­¢è€ç‰ˆæœ¬ä»£ç (ä¸å½±å“ä¸Šä¸€ä¸ªç‰ˆæœ¬è®¿é—®)ï¼Œè€Œæ˜¯åœ¨å¦å¤–ä¸€å¥—ç¯å¢ƒéƒ¨ç½²æ–°ç‰ˆæœ¬ç„¶åè¿›è¡Œæµ‹ è¯•ï¼Œæµ‹è¯•é€šè¿‡åå°†ç”¨æˆ·æµé‡åˆ‡åˆ°æ–°ç‰ˆæœ¬

**é‡‘ä¸é›€(ç°åº¦)å‘å¸ƒ Canary Deployment**

é‡‘ä¸é›€å‘å¸ƒä¹Ÿå«ç°åº¦å‘å¸ƒï¼Œæ˜¯æŒ‡åœ¨é»‘ä¸ç™½ä¹‹é—´ï¼Œèƒ½å¤Ÿå¹³æ»‘è¿‡æ¸¡çš„ä¸€ç§å‘å¸ƒæ–¹å¼ï¼Œç°åº¦å‘å¸ƒæ˜¯å¢é‡å‘å¸ƒ ï¼ˆä¾‹å¦‚ï¼š2%ã€25%ã€75%ã€100%ï¼‰è¿›è¡Œæ›´æ–°)çš„ä¸€ç§ç±»å‹ï¼Œç°åº¦å‘å¸ƒæ˜¯åœ¨åŸæœ‰ç‰ˆæœ¬å¯ç”¨çš„æƒ…å†µä¸‹ï¼ŒåŒæ—¶ éƒ¨ç½²ä¸€ä¸ªæ–°ç‰ˆæœ¬åº”ç”¨ä½œä¸ºâ€œé‡‘ä¸é›€â€(å°ç™½é¼ )ï¼Œæµ‹è¯•æ–°ç‰ˆæœ¬çš„æ€§èƒ½å’Œè¡¨ç°ï¼Œä»¥ä¿éšœæ•´ä½“ç³»ç»Ÿç¨³å®šçš„æƒ…å†µä¸‹ï¼Œ å°½æ—©å‘ç°ã€è°ƒæ•´é—®é¢˜ã€‚

**æ»šåŠ¨å‘å¸ƒ(æ›´æ–°)**



# 2.ç‰ˆæœ¬ç®¡ç†å·¥å…·gitå’Œgitlab

DevOps æ¶‰åŠçš„å››å¤§ç›¸å…³å¹³å° é¡¹ç›®ç®¡ç†ï¼š

å¦‚ï¼šJira,ç¦…é“ ä»£ç æ‰˜ç®¡

å¦‚ï¼šGitlab,SVN æŒç»­äº¤ä»˜

å¦‚ï¼šJenkins,Gitlab è¿ç»´å¹³å°

å¦‚ï¼šè…¾è®¯è“é²¸,Spugç­‰

![image-20250525232329590](./image-20250525232329590.png)

![image-20250525232437427](./image-20250525232437427.png)

```bash
git chechout -b feature #from developï¼Œå®Œæˆå¼€å‘å’Œç‰¹æ€§æµ‹è¯•
git checkout develop
 git merge feature
 git branch --delete feature
 git checkout -b release # from developï¼Œå®Œæˆæµ‹è¯•ã€bugä¿®å¤å’Œå‘å¸ƒ
git checkout develop
 git merge release   
#å°†releaseåˆå¹¶è‡³develop
 git checkout master
 git merge release #å°†releaseåˆå¹¶è‡³master
 git branch --delete release #åˆ é™¤releaeåˆ†æ”¯
```

## 2.1ç§æœ‰ä»“åº“gitlab

![image-20250525232946197](./image-20250525232946197.png)

### 2.1.1GitLab å®‰è£…

Gitlab æœåŠ¡çš„å®‰è£…æ–‡æ¡£ï¼š https://docs.gitlab.com/ce/install/

å®‰è£…çš„æœ€æ–°ç‰ˆ

```powershell
#!/bin/bash
set -e

# é…ç½®è®¿é—®åŸŸåæˆ–IP
DOMAIN="gitlab.local"
EXTERNAL_URL="http://$DOMAIN"

echo "å®‰è£… GitLab CEï¼Œè®¿é—®åœ°å€ï¼š$EXTERNAL_URL"

# æ·»åŠ  GitLab å®˜æ–¹ä»“åº“
curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh | bash

# å®‰è£…æœ€æ–°çš„ GitLab CE
EXTERNAL_URL="$EXTERNAL_URL" dnf install -y gitlab-ce

# åˆå§‹åŒ–é…ç½®å¹¶å¯åŠ¨ GitLab
gitlab-ctl reconfigure

echo ""
echo "âœ… GitLab CE å®‰è£…å®Œæˆï¼"
echo "ğŸ”— è®¿é—®åœ°å€ï¼š $EXTERNAL_URL"
echo "è¯·é¦–æ¬¡è®¿é—®è®¾ç½® root å¯†ç "

```

å®‰è£…æ–¹æ³•è¯´æ˜ https://docs.gitlab.com/ee/install/install_methods.html

Gitlabç¡¬ä»¶å’Œè½¯ä»¶çš„ç¯å¢ƒè¦æ±‚ï¼š  https://docs.gitlab.com/ce/install/requirements.html 

ç¡¬ä»¶é…ç½®è¦æ±‚è¾ƒé«˜ï¼š æµ‹è¯•ç¯å¢ƒï¼šå†…å­˜4Gä»¥ä¸Š ç”Ÿäº§ç¯å¢ƒï¼šå»ºè®®CPU2Cä»¥ä¸Šï¼Œå†…å­˜8Gä»¥ä¸Šï¼Œç£ç›˜10Gä»¥ä¸Šé…ç½®ï¼Œå’Œç”¨æˆ·æ•°æœ‰å…³

**ä¸€é”®å®‰è£…gitlabè„šæœ¬**

### 2.1.2GitLab åŸºæœ¬é…ç½®

é¦–æ¬¡ç™»å½• GitLab Web ç•Œé¢ä¿®æ”¹å¯†ç   æ–°ç‰ˆgitlabå¯†ç åˆå§‹åŒ–å®˜æ–¹å¸®åŠ©é“¾æ¥ https://docs.gitlab.com/omnibus/installation/index.html

æµè§ˆå™¨è®¿é—® http://gitlabæœåŠ¡å™¨IP/

```bash
#å¦‚æœæ²¡æœ‰åœ¨é…ç½®æ–‡ä»¶ä¸­å¯¹å¯†ç åšåˆå§‹åŒ–è®¾ç½®,å¯ä»¥ä»ä»¥ä¸‹æ–‡ä»¶æ‰¾åˆ°åˆå§‹å¯†ç 
[root@ubuntu1804 ~]#cat /etc/gitlab/initial_root_password
```

### 2.1.3GitLab é¡¹ç›®ç®¡ç†

#### ä¿æŠ¤åˆ†æ”¯

![image-20250526022210252](./image-20250526022210252.png)

### 2.1.4GitLab çš„æ•°æ®å¤‡ä»½å’Œæ¢å¤

https://docs.gitlab.com/ee/raketasks/backup_restore.html

#### å¤‡ä»½

å¤‡ä»½ç›¸å…³é…ç½®æ–‡ä»¶  

```bash
/etc/gitlab/gitlab.rb 

/etc/gitlab/gitlab-secrets.json #åŒå› å­éªŒè¯ç­‰ä½¿ç”¨æ­¤æ–‡ä»¶

å¤‡ä»½é…ç½®æ–‡ä»¶å‘½ä»¤
gitlab-ctl backup-etc --backup-path <DIRECTORY>
```

```bash
#GitLab 12.2ä¹‹åç‰ˆæœ¬
gitlab-backup create
 #GitLab 12.1ä¹‹å‰ç‰ˆæœ¬
gitlab-rake gitlab:backup:create

#é»˜è®¤å¤‡ä»½ä¿å­˜åœ¨ä¸‹é¢ç›®å½•
[root@ubuntu1804 ~]#ll /var/opt/gitlab/backups/
```

![image-20250526050040578](./image-20250526050040578.png)

#### æ‰§è¡Œæ¢å¤

```bash
#æ¢å¤å‰å…ˆåœæ­¢ä¸¤ä¸ªæœåŠ¡
[root@ubuntu1804 ~]#gitlab-ctl stop puma
 [root@ubuntu1804 ~]#gitlab-ctl stop sidekiq
 #æ¢å¤æ—¶æŒ‡å®šå¤‡ä»½æ–‡ä»¶çš„æ—¶é—´éƒ¨åˆ†ï¼Œä¸éœ€è¦æŒ‡å®šæ–‡ä»¶çš„å…¨å
[root@ubuntu1804 ~]#gitlab-backup restore BACKUP=å¤‡ä»½æ–‡ä»¶åçš„æ—¶é—´éƒ¨åˆ†_Gitlabç‰ˆæœ¬

[root@ubuntu1804 ~]#gitlab-ctl reconfigure
 [root@ubuntu1804 ~]#gitlab-ctl restart
 #åç»­æ£€æŸ¥å¯é€‰åš
[root@ubuntu1804 ~]#gitlab-rake gitlab:check SANITIZE=true
 #In GitLab 13.1 and later, check database values can be decrypted especially if 
/etc/gitlab/gitlab-secrets.json was restored, or if a different server is the 
target for the restore.
 [root@ubuntu1804 ~]#gitlab-rake gitlab:doctor:secrets
```

æ—§ç‰ˆæ¢å¤æ–¹æ³• 

```bash
#æ¢å¤å‰å…ˆåœæ­¢ä¸¤ä¸ªæœåŠ¡
[root@ubuntu1804 ~]#gitlab-ctl stop unicorn
 [root@ubuntu1804 ~]#gitlab-ctl stop sidekiq 
#æ¢å¤æ—¶æŒ‡å®šå¤‡ä»½æ–‡ä»¶çš„æ—¶é—´éƒ¨åˆ†ï¼Œä¸éœ€è¦æŒ‡å®šæ–‡ä»¶çš„å…¨å
[root@ubuntu1804 ~]# gitlab-rake gitlab:backup:restore BACKUP=å¤‡ä»½æ–‡ä»¶åçš„æ—¶é—´éƒ¨åˆ†
```

ç¡®ä¿è¿˜åŸå®Œæˆ

### 2.1.5GitLab æ±‰åŒ–

![image-20250526052941272](./image-20250526052941272.png)

### 2.1.6GitLab è¿ç§»å’Œå‡çº§

**è¿ç§»æµç¨‹** 

åœ¨åŸGitLabä¸»æœºä¸Šå¤‡ä»½é…ç½®æ–‡ä»¶å’Œæ•°æ® 

åœ¨ç›®æ ‡ä¸»æœºä¸Šå®‰è£…ç›¸åŒçš„ç‰ˆæœ¬çš„GitLabè½¯ä»¶ 

è¿˜åŸé…ç½®å’Œæ•°æ® 

**æœ¬è´¨ä¸Šå°±æ˜¯å¤‡ä»½å’Œæ¢å¤çš„è¿‡ç¨‹**

![image-20250526053608960](./image-20250526053608960.png)

### 2.1.7å®ç° Https

![image-20250526053656547](./image-20250526053656547.png)

# 3.jenkins

å®˜æ–¹æ–‡æ¡£ https://www.jenkins.io/zh/doc/

 Jenkins æ˜¯åŸºäº Java å¼€å‘çš„ä¸€ç§å¼€æºçš„CIï¼ˆContinuous integrationæŒç»­é›†æˆï¼‰&CD (Continuous  DeliveryæŒç»­äº¤ä»˜ï¼ŒContinuous DeploymentæŒç»­éƒ¨ç½²)å·¥å…·

jenkins ç‰ˆæœ¬ 

https://www.jenkins.io/download/ 

https://www.jenkins.io/zh/download/ 

https://mirrors.tuna.tsinghua.edu.cn/jenkins/

## 3.1åŸºç¡€é…ç½®

### 3.1.1æ’ä»¶ç®¡ç†

å°†å‡çº§ç«™ç‚¹URLæ›¿æ¢æˆä¸‹é¢å›½å†…é•œåƒåœ°å€

![image-20250526181535925](./image-20250526181535925.png)

![image-20250526181549334](./image-20250526181549334.png)

### 3.1.2ä¿®æ”¹ Jenkins çš„å¯åŠ¨ç”¨æˆ·ä¸º root(å¯é€‰)

é»˜è®¤Jenkinsä»¥jenkinsçš„ç”¨æˆ·èº«ä»½è¿è¡Œ,ä¼šå¯¼è‡´æƒé™å—é™,å¯ä»¥ä¿®æ”¹serviceæ–‡ä»¶è®¾ä¸ºrootèº«ä»½è¿è¡Œè§£å†³æ­¤é—® é¢˜ 

```bash
#åŸºäº Ubuntuå®‰è£…ä¿®æ”¹ä¸‹é¢æ–‡ä»¶
[root@jenkins ~]#vim /usr/lib/systemd/system/jenkins.service
 #User=jenkins	
 #Group=jenkins
 User=root
 Group=root
 [root@jenkins ~]#systemctl daemon-reload 
[root@jenkins ~]#systemctl restart jenkins.service 
#åŸºäºRHELç³»ç»Ÿå®‰è£…ä¿®æ”¹ä¸‹é¢æ–‡ä»¶
[root@jenkins ~]#vim /etc/sysconfig/jenkins
 #JENKINS_USER="jenkins"
 JENKINS_USER="root"
```

### 3.1.3 Jenkins ä¼˜åŒ–é…ç½®

Jenkins æœåŠ¡å™¨åšä¸ºä¸€ä¸ªCICDå·¥å…·,åç»­ä¼šç»å¸¸ä½¿ç”¨ ssh åè®®è¿æ¥è¿œç¨‹ä¸»æœº,ä¸ºæ–¹ä¾¿è¿æ¥,å»ºè®®ä¿®æ”¹è‡ªåŠ¨ä¿¡ ä»»è¿œç¨‹ä¸»æœº,é¿å…é¦–æ¬¡è¿æ¥çš„äººä¸ºè¾“å…¥yesçš„ç¡®è®¤è¿‡ç¨‹

æ–¹æ³•1: ç³»ç»Ÿç®¡ç† --  å…¨å±€å®‰å…¨é…ç½® 

æ³¨æ„:éœ€è¦å®‰è£…Gitæˆ–è€…Gitlabæ’ä»¶æ‰èƒ½é…ç½®

![image-20250526183538962](./image-20250526183538962.png)

æ–¹æ³•2:  åœ¨ Jenkins æœåŠ¡å™¨ä¿®æ”¹ sshçš„å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ 

```bash
[root@jenkins ~]#vi /etc/ssh/ssh_config 
#  StrictHostKeyChecking ask #ä¿®æ”¹æ­¤è¡Œå¦‚ä¸‹é¢   
StrictHostKeyChecking no #ä¿®æ”¹å®¢æˆ·ç«¯é…ç½®æ— éœ€é‡å¯sshæœåŠ¡
```

**æ€§èƒ½ä¼˜åŒ–**

é»˜è®¤åªèƒ½å¹¶è¡Œ2ä¸ªä»»åŠ¡,å»ºè®®æ ¹æ®CPUæ ¸å¿ƒæ•°,å°†æ‰§è¡Œè€…æ•°é‡ä¿®æ”¹ä¸ºCPUçš„æ ¸æ•°

![image-20250526184715100](./image-20250526184715100.png)

### 3.1.4Jenkins çš„å¤‡ä»½è¿˜åŸ

Jenkinsçš„ç›¸å…³æ•°æ®éƒ½æ˜¯æ”¾åœ¨ä¸»ç›®å½•ä¸­, å°†ä¸»ç›®å½•å¤‡ä»½å³å¯å®ç°Jenkinsçš„å¤‡ä»½,å¿…è¦æ—¶ç”¨äºè¿˜åŸ å¦å¤–å¦‚æœæœ‰ç›¸å…³è„šæœ¬ç­‰,ä¹Ÿéœ€è¦è¿›è¡Œå¤‡ä»½

![image-20250526185820746](./image-20250526185820746.png)

![image-20250526185828420](./image-20250526185828420.png)

### 3.1.5æ‰¾å›å¿˜è®°çš„å¯†ç 

åˆšå¼€å§‹å®‰è£… Jenkinsï¼Œæ²¡æœ‰ä¿®æ”¹è¿‡å¯†ç  ç›´æ¥åœ¨initialAdminPasswordæ–‡ä»¶ä¸­æŸ¥çœ‹å¯†ç å³å¯ 

```bash
[root@ubuntu2204-100 ~]#cat /var/lib/jenkins/secrets/initialAdminPassword c72aae9f6418442b979b10de4c8d275
```

æ–¹æ³•2

![image-20250526190039891](./image-20250526190039891.png)

![image-20250526190109404](./image-20250526190109404.png)

![image-20250526190322450](./image-20250526190322450.png)

![image-20250526190342849](./image-20250526190342849.png)

## 3.2Jenkins å®ç° CICD

![image-20250526191032464](./image-20250526191032464.png)

![image-20250526191044644](./image-20250526191044644.png)

![image-20250526191416092](./image-20250526191416092.png)

### 3.2.1åˆ›å»º Freestyle é£æ ¼çš„ä»»åŠ¡ Job

æ„å»ºæ”¯æŒå˜é‡ http://jenkins-server:8080/env-vars.html/

![image-20250526191718696](./image-20250526191718696.png)

**å®ç°ä¸€ä¸ªç®€å•çš„ Freestyle ä»»åŠ¡**

![image-20250526192329512](./image-20250526192329512.png)

![image-20250526192337560](./image-20250526192337560.png)

#### ç¯å¢ƒå˜é‡ä¸è‡ªå®šä¹‰ç¯å¢ƒå˜é‡

![image-20250526192637064](./image-20250526192637064.png)

ä»»åŠ¡ä¸­çš„è‡ªå®šä¹‰çš„å˜é‡ > Jenkins çš„è‡ªå®šä¹‰ç¯å¢ƒé‡ > Jenkins å†…ç½®çš„ç¯å¢ƒå˜é‡

![image-20250526192658050](./image-20250526192658050.png)

### 3.2.2 Jenkins ç»“åˆ GitLab å®ç°ä»£ç ä¸‹è½½

https://docs.gitlab.com/ee/integration/jenkins.html

![image-20250526193303569](./image-20250526193303569.png)

#### Jenkins æœåŠ¡å™¨åˆ›å»ºè®¿é—®GitLabçš„å‡­æ®

![image-20250526193424319](./image-20250526193424319.png)

![image-20250526193332449](./image-20250526193332449.png)

![image-20250526193537906](./image-20250526193537906.png)

![image-20250526193603021](./image-20250526193603021.png)

![image-20250526193938908](./image-20250526193938908.png)

![image-20250526193945154](./image-20250526193945154.png)

### 3.2.3é…ç½® Jenkins ç»“åˆ GitLab å®ç°è‡ªåŠ¨åŒ–å‰ç«¯é¡¹ç›®çš„éƒ¨ç½² å’Œå›æ»š

1. Jenkins åˆ›å»ºä»»åŠ¡
2. é…ç½® Git é¡¹ç›®åœ°å€å’Œå‡­è¯ï¼Œå…ˆåœ¨gitlabä¸Šç¡®è®¤gitåœ°å€å’Œåˆ†æ”¯åç§°

![image-20250526194450368](./image-20250526194450368.png)

3.å‡†å¤‡è„šæœ¬å¹¶åŠ å…¥æ„å»ºä»»åŠ¡

```bash
HOST_LIST="
10.0.0.202
10.0.0.203
"
APP=wheel
APP_PATH=/var/www/html
DATA_PATH=/opt
DATE=`date +%F_%H-%M-%S`
deploy () {
 Â  Â for i in ${HOST_LIST};do
 Â  Â  Â  Â ssh root@$i "rm -f Â ${APP_PATH} && mkdir -pv 
${DATA_PATH}/${APP}-${DATE}"
 Â  Â  Â  scp -r * root@$i:${DATA_PATH}/${APP}-${DATE}
 Â  Â  Â  Â ssh root@$i "ln -sv ${DATA_PATH}/${APP}-${DATE} ${APP_PATH}"
 Â  Â done
}
rollback() {
 Â  Â for i in ${HOST_LIST};do
 Â  Â  Â  Â CURRENT_VERISION=$(ssh root@$i "readlink $APP_PATH")
 Â  Â  Â  Â CURRENT_VERISION=$(basename ${CURRENT_VERISION})
 Â  Â  Â  Â echo ${CURRENT_VERISION}
 Â  Â  Â  Â PRE_VERSION=$(ssh root@$i "ls -1 ${DATA_PATH} | grep -B1 
${CURRENT_VERISION}|head -n1 ")
 Â  Â  Â  Â echo $PRE_VERSION
 Â  Â  Â  Â ssh root@$i "rm -f Â ${APP_PATH}&& ln -sv ${DATA_PATH}/${PRE_VERSION}
${APP_PATH}"
 Â  Â done
}
case $1 in
deploy)
 Â  deploy
 Â  ;;
rollback)
 Â  rollback
 Â  ;;
*)
 Â  Â exit
 Â  ;;
esac
```

4.åœ¨Jenkinsä¸­å¼•ç”¨è„šæœ¬

![image-20250526194848348](./image-20250526194848348.png)

5.**ç«‹å³æ„å»º**

![image-20250526194928935](./image-20250526194928935.png)

6.**æœåŠ¡å™¨éªŒè¯æ•°æ®**

7.**å°†ä»£ç éƒ¨ç½²è‡³åç«¯** **Web** **æœåŠ¡å™¨**

8.**è®¿é—®** **Web** **æœåŠ¡**

9.**ä¿®æ”¹ä»£ç å†ä¸Šä¼ é‡æ–°æ„å»º**

```bash
git clone git@gitlab.wang.org:dev/wheel_of_fortune.git
cd wheel_of_fortune/
vi index.html 
git add .;git commit -m '500w';git push
```

10.æ–°å»ºä»»åŠ¡ï¼Œå®ç°å›æ»šåŠŸèƒ½

![image-20250526195152142](./image-20250526195152142.png)

### 3.2.4å‚æ•°åŒ–æ„å»º

#### 3.2.4.1å­—ç¬¦å‚æ•°å®ç°å®ç°ä¸åŒåˆ†æ”¯çš„éƒ¨ç½²

![image-20250526202907431](./image-20250526202907431.png)

#### 3.2.4.2é€‰é¡¹å‚æ•°å®ç°å®ç°ä¸åŒåˆ†æ”¯çš„éƒ¨ç½²

![image-20250526203401316](./image-20250526203401316.png)

![image-20250526203413039](./image-20250526203413039.png)

#### 3.2.4.3é€‰é¡¹å‚æ•°å®ç°ä¸åŒåˆ†æ”¯çš„éƒ¨ç½²å’Œå›æ»š

![image-20250526203720004](./image-20250526203720004.png)

### 3.2.5åˆ©ç”¨ Git Parameter æ’ä»¶å®ç°æ‹‰å–æŒ‡å®šç‰ˆæœ¬

#### åˆ©ç”¨ Git Parameter æ’ä»¶å®ç°æ‹‰å–æŒ‡å®š Tag

![image-20250526203937066](./image-20250526203937066.png)

![image-20250526204336638](./image-20250526204336638.png)

#### åˆ©ç”¨ Git Parameter æ’ä»¶å®ç°æ‹‰å–æŒ‡å®š Commit_ID

![image-20250526204454211](./image-20250526204454211.png)

![image-20250526204512023](./image-20250526204512023.png)

### 3.2.6å®ç° Java åº”ç”¨æºç ç¼–è¯‘å¹¶éƒ¨ç½²

#### åŸºäºè‡ªç”±é£æ ¼æ„å»ºåŸºäº Spring Boot çš„ JAR åŒ… JAVA é¡¹ç›®

![image-20250526204634309](./image-20250526204634309.png)

##### Jenkins æœåŠ¡å™¨ä¸Šå®‰è£… maven å’Œé…ç½®é•œåƒåŠ é€Ÿ

æ–¹æ³•1:ç³»ç»Ÿé…ç½®æ–‡ä»¶

![image-20250526210344495](./image-20250526210344495.png)

æ–¹æ³•2ï¼šé€šè¿‡Config File Provideræ’ä»¶å®Œæˆ

æ³¨æ„ï¼šæ­¤æ–¹æ³•åªæ”¯æŒmavené£æ ¼çš„ä»»åŠ¡ï¼Œä¸æ”¯æŒå‘½ä»¤è¡Œçš„mvnå‘½ä»¤

##### Jenkins å…¨å±€å·¥å…·é…ç½® JDK å’Œ Maven

![image-20250526211249637](./image-20250526211249637.png)

æ–¹æ³•1: æ‰‹åŠ¨å®‰è£… maven

æ–¹æ³•2ï¼šè‡ªåŠ¨å®‰è£… Maven

![image-20250526211401683](./image-20250526211401683.png)

#### åŸºäº Maven é£æ ¼çš„ä»»åŠ¡æ„å»ºåŸºäºWARåŒ…è¿è¡Œ TomcatæœåŠ¡å™¨ JAVA é¡¹ç›®

1 Gitlabä»“åº“ä¸­å‡†å¤‡ Java ä»£ç 

2 å®‰è£… tomcat æœåŠ¡å™¨å’Œé…ç½®

3 Jenkins å®‰è£… Maven å’Œ Tomcat ä¸¤ä¸ªæ’ä»¶

4 Jenkins æœåŠ¡å™¨ä¸Šå®‰è£… maven å’Œé…ç½®é•œåƒåŠ é€Ÿ

5 Jenkins å…¨å±€å·¥å…·é…ç½® JDK (å¯é€‰)å’Œ Maven(å¿…é€‰)

6 åˆ›å»º Tomcat çš„å…¨å±€å‡­æ®

7 åˆ›å»º Maven é£æ ¼çš„ä»»åŠ¡

æ³¨æ„: å› Maven é£æ ¼çš„ä»»åŠ¡å­˜åœ¨å®‰å…¨é£é™©, Jenkinså®˜æ–¹å·²ç»ä¸å†å»ºè®®ä½¿ç”¨, ä½¿ç”¨è‡ªç”±é£æ ¼çš„é¡¹ç›®æˆ–è€… Pipelineä½œä¸šæ›¿ä»£

### 3.2.7å®ç° Golang åº”ç”¨æºç ç¼–è¯‘å¹¶éƒ¨ç½²

### 3.2.8é›†æˆ Ansible çš„ä»»åŠ¡æ„å»º

å®˜æ–¹å‚è€ƒ https://plugins.jenkins.io/ansible/

1 å®‰è£… Ansible ç¯å¢ƒ

2 å®‰è£… Ansible æ’ä»¶

3 ä½¿ç”¨ Ansible Ad-Hoc å®ç°ä»»åŠ¡

![image-20250526212030335](./image-20250526212030335.png)

#### ä½¿ç”¨ Ansible Playbook åŸºäºå‚æ•°åŒ–å®ç°ä»»åŠ¡æµ‹è¯•å’Œç”Ÿäº§å¤šå¥— ä¸åŒç¯å¢ƒçš„éƒ¨ç½²

1 å‡†å¤‡Playbookæ–‡ä»¶

2 å‡†å¤‡ä¸¤ä¸ªä¸åŒç¯å¢ƒçš„æ‰€æœ‰ä¸»æœºæ¸…å•æ–‡ä»¶

3 åˆ›å»ºå‚æ•°åŒ–ä»»åŠ¡

![image-20250526212207600](./image-20250526212207600.png)

### 3.2.9æ„å»ºåé€šçŸ¥

#### é‚®ä»¶é€šçŸ¥

2 mailer æ’ä»¶å®ç°é‚®ä»¶å‘Šè­¦

é…ç½® Jenkinsç®¡ç†å‘˜é‚®ç®±

åœ¨ Pipeline ä¸­æ·»åŠ é‚®ä»¶é€šçŸ¥

#### é’‰é’‰é€šçŸ¥

æ’ä»¶è¯´æ˜ https://jenkinsci.github.io/dingtalk-plugin/ https://jenkinsci.github.io/dingtalk-plugin/guide/getting-started.html

![image-20250526213155130](./image-20250526213155130.png)

#### Pipeline å®ç°é’‰é’‰é€šçŸ¥

![image-20250526213305298](./image-20250526213305298.png)

#### å¾®ä¿¡é€šçŸ¥

### 3.2.10è‡ªåŠ¨åŒ–æ„å»º

å‘¨æœŸæ€§æ„å»º 

Webhook è§¦å‘æ„å»º

#### 3.2.10.1å®šæ—¶å’Œ SCM æ„å»º

![image-20250526213636602](./image-20250526213636602.png)

![image-20250526213711389](./image-20250526213711389.png)

![image-20250526213733138](./image-20250526213733138.png)

#### 3.2.10.2æ„å»º Webhook è§¦å‘å™¨

![image-20250526213911401](./image-20250526213911401.png)

### 3.2.11æ„å»ºå‰åå¤šä¸ªé¡¹ç›®å…³è”è‡ªåŠ¨è§¦å‘ä»»åŠ¡æ‰§è¡Œ

### 3.2.12Blue Ocean æ’ä»¶å®ç°å¯è§†åŒ–

### 3.2.13 å®ç°å®¹å™¨åŒ–çš„ Docker ä»»åŠ¡

1 åœ¨harbor.wang.orgä¸»æœºä¸Šå®‰è£…Harbor

2 åœ¨ç›®æ ‡ä¸»æœºå®‰è£… Dockerï¼Œå¹¶ä¸”æ‰“å¼€è¿œç¨‹è¿æ¥ç«¯å£ï¼Œå¹¶ä¸”ä¿¡ä»»harbor

3 åœ¨Gitlab å‡†å¤‡é¡¹ç›®

4 åœ¨ Jenkins åˆ›å»ºä»»åŠ¡

5.ç¼–å†™è„šæœ¬

![image-20250526223754241](./image-20250526223754241.png)

#### åŸºäº Docker æ’ä»¶å®ç°è‡ªç”±é£æ ¼ä»»åŠ¡å®ç° Docker é•œåƒ åˆ¶ä½œ

1 å‡†å¤‡æºç é¡¹ç›®å’Œå¯¹åº”çš„Dockerfile

2 å®‰è£…æ’ä»¶ docker-build-step

3 åœ¨Jenkins å®‰è£…Dockerå¹¶é…ç½® Docker æ’ä»¶

![image-20250526223945591](./image-20250526223945591.png)

```bash
[root@ubuntu2204 ~]#usermod -aG docker jenkins
[root@ubuntu2204 ~]#id jenkins
```

4 åœ¨ Jenkins åˆ›å»ºè¿æ¥ Harbor çš„å‡­è¯

5 åˆ›å»ºä»»åŠ¡

![image-20250526224132352](./image-20250526224132352.png)

### 3.2.14é›†æˆ Kubernetes

![image-20250526224648004](./image-20250526224648004.png)

### 3.2.15æ¨é€æ„å»ºçŠ¶æ€ä¿¡æ¯è‡³GitLab

## 3.3jenkinsåˆ†å¸ƒå¼

![image-20250526225758699](./image-20250526225758699.png)

Javaç¨‹åºåˆ†é…è‡³Slave1,Goç¨‹åºçš„ç¼–è¯‘åˆ†é…ç»™Slave2,Nodejsç¨‹åºåˆ†é…ç»™Slave3

é‡‡ç”¨ master/agent æ¶æ„ï¼Œå› è€Œå…¶èŠ‚ç‚¹å¯åˆ’åˆ†ä¸»èŠ‚ç‚¹(master)å’Œä»£ç†èŠ‚ç‚¹(agent)ä¸¤ç§ç±»å‹,ï¼Œä»£ç†èŠ‚ç‚¹ä¹Ÿ è¢«ç§°ä¸ºä»èŠ‚ç‚¹(slave)

**ä¸»èŠ‚ç‚¹è´Ÿè´£æä¾›UIã€å¤„ç†HTTPè¯·æ±‚åŠç®¡ç†æ„å»ºç¯å¢ƒç­‰ï¼Œè€Œä»£ç†èŠ‚ç‚¹åˆ™ä¸»è¦è´Ÿè´£æ‰§è¡Œæ„å»ºä»»åŠ¡**

![image-20250526225933920](./image-20250526225933920.png)

![image-20250526230245179](./image-20250526230245179.png)

### å®æˆ˜æ¡ˆä¾‹: åŸºäº SSH åè®®å®ç° Jenkins åˆ†å¸ƒå¼

### å®æˆ˜æ¡ˆä¾‹: åŸºäºdocker-compose é€šè¿‡SSH å®ç° Jenkins åˆ†å¸ƒ å¼

### æ¡ˆä¾‹ï¼šKubernetsé›†ç¾¤å®ç°Jenkinsåˆ†å¸ƒå¼æ„å»º

## 3.4jenkins pipeline

æ‰€è°“çš„ Pipeline æµæ°´çº¿ï¼Œå…¶å®å°±æ˜¯å°†ä¹‹å‰çš„ä¸€ä¸ªä»»åŠ¡æˆ–è€…ä¸€ä¸ªè„šæœ¬å°±åšå®Œçš„å·¥ä½œï¼Œç”¨ Pipeline è¯­æ³•åˆ’åˆ† ä¸ºå¤šä¸ªå­ä»»åŠ¡ç„¶ååˆ†åˆ«æ‰§è¡Œï¼Œä¸¤è€…å®ç°çš„æœ€ç»ˆæ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ç”±äºåŸå§‹ä»»åŠ¡åˆ’åˆ†ä¸ºå¤šä¸ªå­ä»»åŠ¡ä¹‹ åï¼Œä»¥æµæ°´çº¿çš„æ–¹å¼æ¥æ‰§è¡Œï¼Œé‚£ä¹ˆå°±å¯ä»¥éšæ—¶æŸ¥çœ‹ä»»æ„å­ä»»åŠ¡çš„æ‰§è¡Œæ•ˆæœï¼Œå³ä½¿åœ¨æŸä¸ªé˜¶æ®µå‡ºç°é—®é¢˜ï¼Œ æˆ‘ä»¬ä¹Ÿå¯ä»¥éšæ—¶ç›´æ¥å®šä½é—®é¢˜çš„å‘ç”Ÿç‚¹ï¼Œå¤§å¤§æé«˜é¡¹ç›®çš„æ•ˆç‡,å³æ¨¡å—åŒ–å®Œæˆå¤æ‚ä»»åŠ¡çš„æ€æƒ³ä½“ç°

![image-20250526230946405](./image-20250526230946405.png)

```bash
å®˜æ–¹æ–‡æ¡£
https://www.jenkins.io/zh/doc/book/pipeline/syntax/
 http://www.jenkins.io/doc/book/pipeline/syntax/
 http://www.jenkins.io/doc/pipeline/steps/
 #æ”¯æŒdocker
 https://www.jenkins.io/doc/book/pipeline/docker/
```

![image-20250526231308727](./image-20250526231308727.png)

### å®ç°ä¸€ä¸ªç®€å• Pipeline Job

1 å®‰è£… Pipeline æ’ä»¶

![image-20250526231635327](./image-20250526231635327.png)

![image-20250526231648031](./image-20250526231648031.png)

2 åˆ›å»º Pipeline Job

![image-20250526231715842](./image-20250526231715842.png)

3 æµ‹è¯•ç®€å• Pipeline Job è¿è¡Œ

![image-20250526231749136](./image-20250526231749136.png)

![image-20250526231755056](./image-20250526231755056.png)

![image-20250526231808369](./image-20250526231808369.png)

### è‡ªåŠ¨ç”Ÿæˆæ‹‰å–ä»£ç çš„ Pipeline è„šæœ¬

![image-20250526231908374](./image-20250526231908374.png)

### å›æ”¾

![image-20250526232005939](./image-20250526232005939.png)



### å®æˆ˜æ¡ˆä¾‹: è„šæœ¬å¼ Pipeline

![image-20250526232049737](./image-20250526232049737.png)

![image-20250526232145885](./image-20250526232145885.png)

æŒ‡å®šnodeèŠ‚ç‚¹

![image-20250526233427815](./image-20250526233427815.png)

### å®æˆ˜æ¡ˆä¾‹: å£°æ˜å¼ Pipeline

![image-20250527032802540](./image-20250527032802540.png)

![image-20250527032844937](./image-20250527032844937.png)

![image-20250527033109547](./image-20250527033109547.png)

![image-20250527033125731](./image-20250527033125731.png)

## 3.5Jenkins è§†å›¾

è§†å›¾å¯ç”¨äºå½’æ¡£jobè¿›è¡Œåˆ†ç»„æ˜¾ç¤ºï¼Œæ¯”å¦‚å°†ä¸€ä¸ªä¸šåŠ¡çš„è§†å›¾æ”¾åœ¨ä¸€ä¸ªè§†å›¾æ˜¾ç¤ºï¼Œå®‰è£…å®Œæˆæ’ä»¶ä¹‹åå°†ä¼šæœ‰ ä¸€ä¸ª+å·ç”¨äºåˆ›å»ºè§†å›¾ï¼Œæ”¯æŒä¸‰ç§è§†å›¾ï¼Œå…¶ä¸­åˆ—è¡¨è§†å›¾ä½¿ç”¨è¾ƒå¤šã€‚

### åˆ—è¡¨è§†å›¾

![image-20250527115956354](./image-20250527115956354.png)

1 åˆ›å»ºæ–°çš„è§†å›¾

2 å®šä¹‰è§†å›¾åç§°

3 é€‰æ‹©è§†å›¾åŒ…å«çš„ä»»åŠ¡

![image-20250527120026387](./image-20250527120026387.png)

### æˆ‘çš„è§†å›¾

æˆ‘çš„è§†å›¾ä¼šæ˜¾ç¤ºå½“å‰è´¦æˆ·æœ‰æƒé™è®¿é—®çš„jobï¼Œå› æ­¤éœ€è¦æå‰åˆ’åˆ†å¥½æƒé™

![image-20250527120112601](./image-20250527120112601.png)

### Pipeline è§†å›¾

Pipeline è§†å›¾å¯ä»¥æ˜¾ç¤ºä»»åŠ¡ä¹‹é—´çš„ä¸Šä¸‹æ¸¸å…³ç³»ï¼Œè€ŒéPipelineé£æ ¼çš„ä»»åŠ¡

## 3.6Jenkins æƒé™ç®¡ç†

é»˜è®¤jenkinsç”¨æˆ·å¯ä»¥æ‰§è¡Œæ‰€æœ‰æ“ä½œå’Œç®¡ç†æ‰€æœ‰job ä¸ºäº†æ›´å¥½çš„åˆ†å±‚æ§åˆ¶ï¼Œå¯ä»¥å®ç°åŸºäºè§’è‰²çš„æƒé™ç®¡ç†ï¼Œå…ˆåˆ›å»ºè§’è‰²å’Œç”¨æˆ·ï¼Œç»™è§’è‰²æˆæƒï¼Œç„¶åæŠŠç”¨æˆ·ç®¡ ç†åˆ°è§’è‰²ã€‚

![image-20250527120824782](./image-20250527120824782.png)

![image-20250527120847711](./image-20250527120847711.png)

### 3.6.1å®‰è£…è§’è‰²æƒé™ç›¸å…³çš„æ’ä»¶

æœç´¢Role-based Authorization Strategyå¯ä»¥æ‰¾åˆ°ä¸‹é¢æ’ä»¶

![image-20250527120946069](./image-20250527120946069.png)

![image-20250527121119016](./image-20250527121119016.png)

![image-20250527121159018](./image-20250527121159018.png)

é¡¹ç›®è§’è‰²

## 3.7ä»£ç è´¨é‡æ£€æµ‹ SonarQube

### 3.7.1ä»£ç æµ‹è¯•å·¥å…· SonarQube ç®€ä»‹

å®˜æ–¹ç½‘ç«™ï¼š http://www.sonarqube.org/  

ä¸‹è½½åœ°å€ï¼š https://www.sonarqube.org/downloads/

![image-20250527183829226](./image-20250527183829226.png)

![image-20250527183952879](./image-20250527183952879.png)

Sonaræœ‰ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼šæ’ä»¶å’Œå®¢æˆ·ç«¯

Sonarçš„æ’ä»¶åç§°ä¸º sonarlint,å®ç°æ”¯æŒå¤šç§å¼€å‘å·¥å…·çš„IDEçš„æ’ä»¶å®‰è£…

å®˜æ–¹LTSç‰ˆæœ¬è¯´æ˜ https://www.sonarqube.org/downloads/lts/

### 3.7.2ç³»ç»Ÿå†…æ ¸ä¼˜åŒ–  

https://docs.sonarqube.org/latest/requirements/prerequisites-and-overview/

```bash
#mv.max_map_count ç”¨äºé™åˆ¶ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰çš„VMA(è™šæ‹Ÿå†…å­˜åŒºåŸŸ)çš„æ•°é‡
sysctl -w vm.max_map_count=524288
 #è®¾ç½®ç³»ç»Ÿæœ€å¤§æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•°
sysctl -w fs.file-max=131072
 #æ¯ä¸ªç”¨æˆ·å¯ä»¥æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•°
ulimit -n 131072
 #æ¯ä¸ªç”¨æˆ·å¯ä»¥æ‰“å¼€çš„çº¿ç¨‹æ•°
ulimit -u 8192
```

```bash
[root@SonarQube-Server ~]#vim /etc/sysctl.conf
 vm.max_map_count=262144  #æ­¤é¡¹å¿…é¡»ä¿®æ”¹,å¦åˆ™æ— æ³•å¯åŠ¨
fs.file-max=65536        
#æ­¤é¡¹å¯ä¸æ”¹,é»˜è®¤å€¼æ»¡è¶³è¦æ±‚
#æ­¤æ–‡ä»¶å¯ä¸æ”¹,å¯é€‰
[root@SonarQube-Server ~]# vim /etc/security/limits.conf
 sonarqube  -  nofile  65536
 sonarqube  -  nproc  4096
root       -  nofile  65536  
root        -  nproc  4

 #å¦‚æœä»¥systemd è¿è¡ŒSonarQube,éœ€è¦åœ¨serviceæ–‡ä»¶é…ç½®
[servcie]
 .....
 LimitNOFILE=65536
 LimitNPROC=4096
 ......
```

### 3.7.3ç¯å¢ƒä¾èµ–è¯´æ˜

**æ•°æ®åº“**

SonarQube 7.9 ä»¥ä¸Šç‰ˆæœ¬çš„æ•°æ®åº“è¦æ±‚  https://docs.sonarqube.org/7.9/requirements/requirements/ 

æ³¨æ„ï¼šSonarQube 7.9 ä¸å†æ”¯æŒMySQLï¼Œå¯ä»¥é€‰æ‹©å®‰è£… PostgreSQL

SonarQube 6.7 çš„æ•°æ®åº“è¦æ±‚  https://docs.sonarqube.org/6.7/Requirements.html 

SonarQube 6.7 æ•°æ®åº“è¦ä½¿ç”¨MySQL 5.6ç‰ˆæœ¬ï¼Œä¸æ”¯æŒMySQL 5.5çš„ç‰ˆæœ¬

**java**

SonarQube 9.9 ä»¥ä¸Šç‰ˆæœ¬çš„ java ç¯å¢ƒè¦æ±‚  

https://docs.sonarsource.com/sonarqube/latest/requirements/prerequisites-and-overview/

SonarQube 7.9 ä»¥ä¸Šç‰ˆæœ¬ä¸å†æ”¯æŒ java 11    å®‰è£… openjdk-17-jdk

SonarQube 7.9 ä»¥ä¸Šç‰ˆæœ¬ä¸å†æ”¯æŒ java 8      å®‰è£… openjdk-11-jdk

 

### 3.7.4å®‰è£… SonarQube æœåŠ¡å™¨

1 å®‰è£…å’Œé…ç½® PostgreSQL æ•°æ®åº“(æˆ–mysql)

2 2 ä¸‹è½½ SonarQube å’Œä¿®æ”¹é…ç½®æ–‡ä»¶

è®¾ç½® SonarQube è¿æ¥æ•°æ®åº“

3 å¯åŠ¨ SonarQube

æ³¨æ„:SonarQube éœ€è¦è°ƒç”¨ Elasticsearchï¼Œè€Œä¸”é»˜è®¤éœ€è¦ä½¿ç”¨æ™®é€šç”¨æˆ·å¯åŠ¨ï¼Œå¦‚æœä»¥rootå¯åŠ¨ä¼šæŠ¥é”™

4 åˆ›å»º service æ–‡ä»¶

5 ç™»å½•åˆ° Web ç•Œé¢

http://SonarQubeæœåŠ¡å™¨IP:9000

#### é€šè¿‡ Docker compose éƒ¨ç½² SonarQube

### 3.7.5ç®¡ç† SonarQube æœåŠ¡å™¨

```bash
#åˆå§‹æ­¤ç›®å½•æ²¡æœ‰æ’ä»¶æ–‡ä»¶ 
[root@SonarQube-Server ~]#ll /usr/local/sonarqube/extensions/plugins/
```

#### å®‰è£…ä¸­æ–‡è¯­è¨€æ’ä»¶

#### å®‰è£…å…¶ä»–æ’ä»¶  

Sonarquebeå¯¹ä»£ç çš„æ‰«æéƒ½åŸºäºæ’ä»¶å®ç°ï¼Œå› æ­¤è¦å®‰è£…æ‰«æçš„å„ç§å¼€å‘è¯­è¨€çš„æ’ä»¶

é»˜è®¤å·²å®‰è£… Javaã€Pythonã€Goï¼ŒPhpï¼ŒjavaScriptï¼ŒHtml ç­‰è¯­è¨€å¯¹åº”çš„æ’ä»¶

æ’ä»¶å¯ä»¥åœ¨githubä¸Šæ‰¾åˆ°æœ€æ–°ç‰ˆæœ¬ https://github.com/SonarSource

### 3.7.6æƒé™ç®¡ç†

![image-20250527185458077](./image-20250527185458077.png)

### 3.7.7éƒ¨ç½²ä»£ç æ‰«æå™¨ sonar-scanner

å®˜æ–¹æ–‡æ¡£ï¼š https://docs.sonarqube.org/latest/analysis/scan/sonarscanner/

**sonar-scanner å®‰è£…æ–¹æ³•2ï¼šåœ¨ Jenkins å…¨å±€toolsä¸­è‡ªåŠ¨å®‰è£…**

![image-20250527190006114](./image-20250527190006114.png)

![image-20250527190041239](./image-20250527190041239.png)

**å‡†å¤‡æµ‹è¯•ä»£ç å’Œé…ç½®æ–‡ä»¶**

sonar-scanner æ‰«æçš„ä»£ç éœ€è¦æå‰åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹å‡†å¤‡åç§°ä¸ºsonar-project.propertiesçš„æ–‡ä»¶ï¼Œå†… å®¹å¦‚ä¸‹

![image-20250527190934275](./image-20250527190934275.png)

#### åœ¨æºä»£ç ç›®å½•æ‰§è¡Œæ‰«æ

ç›´æ¥æ‰§è¡Œ/usr/local/sonar-scanner/bin/sonar scanner

#### Mavenå®ç°ä»£ç æ£€æµ‹

![image-20250527191759655](./image-20250527191759655.png)

#### SonarQube Web ç•Œé¢éªŒè¯æ‰«æç»“æœ

### 3.7.8Jenkins å’Œ SonarQube é›†æˆå®ç°ä»£ç æ‰«æ

![image-20250527191405354](./image-20250527191405354.png)

Jenkinså€ŸåŠ©äºSonarQube Scanneræ’ä»¶å°†SonarQubeæä¾›çš„ä»£ç è´¨é‡æ£€æŸ¥èƒ½åŠ›é›†æˆåˆ°pipelineä¸Š,ä»è€Œ ç¡®ä¿è´¨é‡é˜ˆæ£€æŸ¥å¤±è´¥æ—¶ï¼Œèƒ½å¤Ÿé¿å…ç»§ç»­è¿›è¡Œåç»­çš„æ“ä½œï¼Œä¾‹å¦‚å‘å¸ƒç­‰

#### SonarQube è´¨é‡é˜ˆ

ä»£ç è´¨é‡æ‰«æç»“æœå¯æ»¡è¶³è¿™ç»„æ¡ä»¶æ—¶,é¡¹ç›®æ‰ä¼šè¢«æ ‡è®°ä¸ºâ€œpassedâ€

![image-20250527191458995](./image-20250527191458995.png)

#### Jenkins é€šè¿‡ Shell å®ç° sonar scanner åŠŸèƒ½

#### Jenkins å®‰è£… SonarQube æ’ä»¶å®ç°ä»£ç æ‰«æ

1.åœ¨ Jenkinsä¸Šå®‰è£…SonarQubeæ’ä»¶

2.é…ç½®Jenkinså¯¹æ¥åˆ°SonarQube Server

3.é…ç½®Jenkinsçš„å…¨å±€å·¥å…·sonar-scanner

4.åœ¨SonarQubeä¸Šæ·»åŠ å›è°ƒJenkinsçš„Webhook

5.åœ¨Jenkinsé¡¹ç›®ä¸Šè°ƒç”¨sonar-scannerè¿›è¡Œä»£ç è´¨é‡æ‰«æ

6.é€šè¿‡SonarQubeç¡®è®¤æ‰«æç»“æœçš„è¯„ä¼°

æ³¨æ„ï¼Œè¾¾æˆéƒ¨ç½²ç›®çš„çš„æ–¹å¼éƒ½å¯ä»¥æ·»åŠ è¿™ä¸€å±‚

### 3.7.9æ¡ˆä¾‹1: Pipeline é›†æˆ SonarQube å®ç°ä»£ç æ£€æµ‹é€šçŸ¥ Jenkins

1 åœ¨ SonarQube æ·»åŠ  Jenkins çš„å›è°ƒæ¥å£

2.å‡†å¤‡é¡¹ç›®çš„ Jenkinsfile æ–‡ä»¶

åœ¨é¡¹ç›®æ‰€åœ¨çš„ç›®å½•ä¸­å‡†å¤‡Jenkinsfileæ–‡ä»¶

æ³¨æ„: ä¹‹åéœ€è¦git commit æ­¤æ–‡ä»¶

![image-20250527192733136](./image-20250527192733136.png)

### 3.7.10æ¡ˆä¾‹2: åŸºäº PipeLine å®ç° JAVAé¡¹ç›®é›†æˆ SonarQube ä»£ç æ£€æµ‹é€šçŸ¥ Jenkins(æ¨èæ“ä½œï¼‰

## 3.8å®‰è£… Harbor å¹¶é…ç½® Jenkins è¿æ¥ Harbor

