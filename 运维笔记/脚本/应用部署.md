[TOC]

# 1.linuxåº”ç”¨éƒ¨ç½²è„šæœ¬

## 1.1nginxå•æœºéƒ¨ç½²

åŸºäºrocky9

```shell
#!/bin/bash
#
#****************************************************
#Author:         zhangzhihai
#Date:           2025-06-10 
#FileName:       nginx_install.sh
#Description:    test
#***************************************************


#ä¸€æ—¦æœ‰å‘½ä»¤å¤±è´¥ç«‹å³é€€å‡º
set -e

LOG_FILE="/data/shell/install.log"
#æ›¿æ¢å½“å‰è¿›ç¨‹çš„IOé‡å®šå‘

exec > >(tee -a "$LOG_FILE") 2>&1
# å®‰è£…ä¾èµ–ï¼ˆé€‚é…Rocky9çš„dnfåŒ…ç®¡ç†å™¨ï¼‰
dnf install -y gcc make pcre-devel zlib-devel openssl-devel wget tar || {
    echo "ä¾èµ–å®‰è£…å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–è½¯ä»¶æºé…ç½®" >&2
    exit 1
}

echo "ã€$(date '+%Y-%m-%d %H:%M:%S')ã€‘å¼€å§‹å®‰è£… Nginx"

NGINX_VERSION="1.26.2"
INSTALL_DIR="/usr/local/nginx"
SRC_DIR="/tmp/nginx-${NGINX_VERSION}"
TARBALL="nginx-${NGINX_VERSION}.tar.gz"

# æ£€æŸ¥å¹¶æ¸…ç†æ—§å®‰è£…
if [ -d "$INSTALL_DIR" ]; then
    echo "æ£€æµ‹åˆ°ç°æœ‰ Nginx å®‰è£…ï¼Œæ˜¯å¦è¦†ç›–ï¼Ÿ(y/N)"
    read -n1 choice
    [[ "$choice" != "y" && "$choice" != "Y" ]] && exit 1
    rm -rf "$INSTALL_DIR"
fi

# ä¸‹è½½è§£å‹
cd /tmp
# åˆ¤æ–­æ˜¯å¦å·²æœ‰æºç åŒ…
if [ -f "$TARBALL" ]; then
    echo "æ£€æµ‹åˆ°æ–‡ä»¶ $TARBALL å·²å­˜åœ¨ï¼Œæ˜¯å¦è·³è¿‡ä¸‹è½½å¹¶ç»§ç»­å®‰è£…ï¼Ÿ(y/N)"
    read -n1 choice
    if [[ "$choice" != "y" && "$choice" != "Y" ]]; then
        echo "æ“ä½œå·²å–æ¶ˆ"
        exit 1
    fi
else
    echo "æ­£åœ¨ä¸‹è½½ Nginx ${NGINX_VERSION}..."
    wget "http://nginx.org/download/${TARBALL}" || {
        echo "ä¸‹è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥" >&2
        exit 1
    }
fi

# è§£å‹æºç åŒ…
if [ -d "$SRC_DIR" ]; then
    echo "æ£€æµ‹åˆ°æºç ç›®å½• $SRC_DIR å·²å­˜åœ¨ï¼Œæ˜¯å¦æ¸…ç†åé‡æ–°è§£å‹ï¼Ÿ(y/N)"
    read -n1 choice
    echo
    if [[ "$choice" == "y" || "$choice" == "Y" ]]; then
        rm -rf "$SRC_DIR"
        tar zxvf "$TARBALL"
    else
        echo "å°†ä½¿ç”¨ç°æœ‰æºç ç›®å½•ç»§ç»­ç¼–è¯‘"
    fi
else
    tar zxvf "$TARBALL"
fi

cd "$SRC_DIR" || exit 1

# åˆ›å»ºè¿è¡Œç”¨æˆ·
if ! id nginx &>/dev/null; then
    groupadd -r nginx
    #-M	ä¸åˆ›å»ºç”¨æˆ·çš„å®¶ç›®å½•ï¼Œ-dæŒ‡å®šç”¨æˆ·å®¶ç›®å½•
    useradd -r -g nginx -s /sbin/nologin -M -d /var/cache/nginx nginx
fi

# åˆ›å»ºç¼“å­˜ç›®å½•
mkdir -p /var/cache/nginx
chown nginx:nginx /var/cache/nginx

# ç¼–è¯‘é…ç½®
./configure \
    --prefix="$INSTALL_DIR" \
    --user=nginx \
    --group=nginx \
    --conf-path=/etc/nginx/nginx.conf \
    --error-log-path=/var/log/nginx/error.log \
    --http-log-path=/var/log/nginx/access.log \
    --with-http_ssl_module \
    --with-http_stub_status_module \
    --with-http_gzip_static_module \
    --with-pcre \
    --with-threads \
    --with-file-aio \
    --with-http_v2_module \
    --with-http_realip_module \
    --with-stream \
    --with-stream_ssl_module \
    --with-stream_realip_module

#-jï¼šè¡¨ç¤ºå¹¶è¡Œç¼–è¯‘ï¼ˆå¤šçº¿ç¨‹ç¼–è¯‘ï¼‰,ä½ çš„æœåŠ¡å™¨æ˜¯ 4 æ ¸ CPUï¼Œnproc å°±ä¼šè¿”å› 4
make -j$(nproc) && make install

# systemd æœåŠ¡
cat > /usr/lib/systemd/system/nginx.service <<EOF
[Unit]
Description=nginx service
After=network-online.target remote-fs.target nss-lookup.target
Wants=network-online.target

[Service]
Type=forking
PIDFile=${INSTALL_DIR}/logs/nginx.pid
ExecStart=${INSTALL_DIR}/sbin/nginx
ExecReload=${INSTALL_DIR}/sbin/nginx -s reload
ExecStop=${INSTALL_DIR}/sbin/nginx -s quit
#ä¸ºè¯¥æœåŠ¡åˆ›å»ºä¸€ä¸ªç§æœ‰çš„ä¸´æ—¶ç›®å½• /tmpï¼Œä¸ç³»ç»Ÿçš„ /tmp éš”ç¦»
PrivateTmp=true
WorkingDirectory=${INSTALL_DIR}

#æ‰“å¼€æ–‡ä»¶é™åˆ¶ï¼Œç³»ç»Ÿä¸€èˆ¬é™åˆ¶1024/4096ï¼Œæ‰€ä»¥è¿˜è¦è¿›è¡Œç³»ç»Ÿä¼˜åŒ–åæ‰æœ‰å¯èƒ½ç”Ÿæ•ˆï¼Œæ¯”å¦‚æ›´æ”¹ç¡¬é™åˆ¶
LimitNOFILE=65535

[Install]
WantedBy=multi-user.target
EOF

# å¯åŠ¨æœåŠ¡
systemctl daemon-reload
systemctl enable --now nginx

# åˆ›å»ºè½¯é“¾æ¥ä¾¿äºå…¨å±€è°ƒç”¨
if [ -L "/usr/sbin/nginx" ]; then
    echo "/usr/sbin/nginx å·²å­˜åœ¨ä¸ºè½¯é“¾æ¥ï¼Œæ˜¯å¦é‡æ–°åˆ›å»ºï¼Ÿ(y/N)"
    read -n1 choice
    echo
    if [[ "$choice" == "y" || "$choice" == "Y" ]]; then
        rm -f "/usr/sbin/nginx"
        ln -sf "${INSTALL_DIR}/sbin/nginx" /usr/sbin/nginx
        echo "å·²é‡æ–°åˆ›å»ºè½¯é“¾æ¥ /usr/sbin/nginx"
    else
        echo "ä¿ç•™ç°æœ‰è½¯é“¾æ¥"
    fi
elif [ -e "/usr/sbin/nginx" ]; then
    echo "è­¦å‘Šï¼š/usr/sbin/nginx å·²å­˜åœ¨ä¸”ä¸æ˜¯è½¯é“¾æ¥ï¼Œè·³è¿‡åˆ›å»º"
else
    ln -sf "${INSTALL_DIR}/sbin/nginx" /usr/sbin/nginx
    echo "å·²åˆ›å»ºè½¯é“¾æ¥ /usr/sbin/nginx"
fi

# è¾“å‡ºç»“æœ
echo "å®‰è£…å®Œæˆï¼Œè®¿é—®åœ°å€: http://$(hostname -I | awk '{print $1}')ï¼Œï¼Œè™šæ‹Ÿæœºå¯è®¿é—®ï¼Œä¸»æœºä¸è¡Œæ³¨æ„å…³é—­é˜²ç«å¢™"
```

## 1.2mysqlå•æœºéƒ¨ç½²

æ–‡æ¡£å³å¤±æ•ˆï¼Œè¿™ç§éƒ¨ç½²æ–¹å¼å·²ç»å¤±æ•ˆï¼Œé™¤éæœ‰è‡ªå·±çš„mysqläºŒè¿›åˆ¶åŒ…ï¼Œå¦åˆ™è¿˜æ˜¯ç›´æ¥yumå®‰è£…ï¼Œmysqlå®˜æ–¹å·²ç»ä¸å†æä¾›linuxçš„mysqläºŒè¿›åˆ¶åŒ…ä¸‹è½½äº†

```go
#!/bin/bash
#
#****************************************************
#Author:         zhangzhihai
#Date:           2025-06-27
#FileName:       mysql8_install.sh
#Description:    default install mysql8.0.36
#***************************************************

#å¦‚æœæ²¡æœ‰æŒ‡å®šç‰ˆæœ¬å‚æ•°ï¼Œåˆ™é»˜è®¤å®‰è£…8.0.36ç‰ˆæœ¬

set -e
# ========== é…ç½®é¡¹ ==========
MYSQL_VERSION="${1:-8.0.36}"
INSTALL_DIR="/usr/local/mysql"
DATA_DIR="/data/mysql"
MYSQL_USER="mysql"
TMP_DIR="/tmp/mysql_src"
MY_CNF_PATH="/etc/my.cnf"
SYSTEMD_UNIT_PATH="/etc/systemd/system/mysqld.service"
# ============================

# åŠ è½½ç¯å¢ƒå˜é‡å¹¶è·å–ç³»ç»Ÿç±»å‹
OS_ID=$(source /etc/os-release && echo $ID)

#æ£€æŸ¥å½“å‰ç¯å¢ƒä¸‹æ˜¯å¦å­˜åœ¨mysql
check_existing_mysql() {
    if command -v mysqld >/dev/null || command -v mysql >/dev/null; then
        echo "??  æ£€æµ‹åˆ°ç³»ç»Ÿä¸­å·²å®‰è£… MySQL æˆ–å­˜åœ¨ mysqld/mysql å‘½ä»¤ã€‚"
        read -p "æ˜¯å¦ç»§ç»­å®‰è£…å¹¶å¯èƒ½è¦†ç›–ç°æœ‰ MySQLï¼Ÿ[y/N]: " confirm
        if [[ "$confirm" != "y" && "$confirm" != "Y" ]]; then
            echo "?? å®‰è£…ä¸­æ­¢ã€‚"
            exit 1
        fi
        echo "? ç”¨æˆ·ç¡®è®¤ç»§ç»­ï¼Œç»§ç»­å®‰è£…..."
    else
        echo "? æœªæ£€æµ‹åˆ°å·²å®‰è£… MySQLï¼Œç»§ç»­å®‰è£…æµç¨‹ã€‚"
    fi
}


# å‡½æ•°ï¼šæ£€æŸ¥ç‰ˆæœ¬æ˜¯å¦å­˜åœ¨
check_version_exists() {
    echo "æ£€æŸ¥ MySQL ç‰ˆæœ¬ $MYSQL_VERSION æ˜¯å¦å­˜åœ¨..."
    TEST_URL="https://downloads.mysql.com/archives/get/p/${MYSQL_VERSION:0:1}/file/mysql-${MYSQL_VERSION}.tar.gz"
    if ! curl -fsI "$TEST_URL" >/dev/null; then
        echo "? æŒ‡å®šç‰ˆæœ¬ mysql-${MYSQL_VERSION}.tar.gz ä¸å­˜åœ¨ï¼Œå®‰è£…ä¸­æ­¢ã€‚"
        exit 1
    fi
    echo "? ç‰ˆæœ¬å­˜åœ¨ï¼Œç»§ç»­å®‰è£…..."
    DOWNLOAD_URL="$TEST_URL"
}

# å‡½æ•°ï¼šå®‰è£…ä¾èµ–
install_deps() {
    echo "å®‰è£…ä¾èµ–..."
    if [[ $OS_ID =~ (centos|rocky|rhel|almalinux) ]]; then
        yum -y install gcc gcc-c++ cmake make bison ncurses-devel openssl-devel wget curl
    elif [[ $OS_ID =~ (ubuntu|debian) ]]; then
        apt-get update
        apt-get -y install build-essential cmake libncurses5-dev libssl-dev bison wget curl
    else
        echo "? ä¸æ”¯æŒçš„ç³»ç»Ÿï¼š$OS_ID"
        exit 1
    fi
}

# å‡½æ•°ï¼šå‡†å¤‡ç¯å¢ƒ
prepare_env() {
    echo "å‡†å¤‡ç¯å¢ƒ..."
    groupadd -f $MYSQL_USER
    id $MYSQL_USER &>/dev/null || useradd -r -g $MYSQL_USER -s /sbin/nologin $MYSQL_USER
    mkdir -p $INSTALL_DIR $DATA_DIR $TMP_DIR
    chown -R $MYSQL_USER:$MYSQL_USER $INSTALL_DIR $DATA_DIR
}

# å‡½æ•°ï¼šä¸‹è½½ MySQL æºç 
download_mysql() {
    echo "ä¸‹è½½ MySQL æºç  ${MYSQL_VERSION}..."
    cd $TMP_DIR
    if [[ ! -f mysql-${MYSQL_VERSION}.tar.gz ]]; then
        wget -c $DOWNLOAD_URL
    fi
    tar -xf mysql-${MYSQL_VERSION}.tar.gz
}

# å‡½æ•°ï¼šç¼–è¯‘å®‰è£…
build_mysql() {
    echo "ç¼–è¯‘å®‰è£… MySQL..."
    cd $TMP_DIR/mysql-${MYSQL_VERSION}
    cmake . -DCMAKE_INSTALL_PREFIX=$INSTALL_DIR \
            -DMYSQL_DATADIR=$DATA_DIR \
            -DSYSCONFDIR=/etc \
            -DWITH_INNOBASE_STORAGE_ENGINE=1 \
            -DWITH_PARTITION_STORAGE_ENGINE=1 \
            -DWITH_FEDERATED_STORAGE_ENGINE=1 \
            -DWITH_BLACKHOLE_STORAGE_ENGINE=1 \
            -DWITH_ARCHIVE_STORAGE_ENGINE=1 \
            -DENABLED_LOCAL_INFILE=1 \
            -DWITH_SSL=system \
            -DWITH_ZLIB=system \
            -DWITH_BOOST=boost \
            -DFORCE_INSOURCE_BUILD=1 \
            -DDOWNLOAD_BOOST=1 \
            -DWITH_DEBUG=0
    make -j"$(nproc)"
    make install
}

# å‡½æ•°ï¼šåˆå§‹åŒ– MySQL
init_mysql() {
    echo "åˆå§‹åŒ–æ•°æ®åº“..."
    $INSTALL_DIR/bin/mysqld --initialize-insecure --basedir=$INSTALL_DIR --datadir=$DATA_DIR --user=$MYSQL_USER
}

# å‡½æ•°ï¼šç”Ÿæˆé…ç½®æ–‡ä»¶
generate_mycnf() {
    echo "ç”Ÿæˆ my.cnf..."
    cat > $MY_CNF_PATH <<EOF
[client]
port = 3306
socket = /tmp/mysql.sock

[mysqld]
user = mysql
port = 3306
basedir = $INSTALL_DIR
datadir = $DATA_DIR
socket = /tmp/mysql.sock
pid-file = $DATA_DIR/mysqld.pid

# InnoDB settings
innodb_buffer_pool_size = 1G
innodb_log_file_size = 256M
innodb_file_per_table = 1
innodb_flush_method = O_DIRECT

# Connections
max_connections = 2000
max_connect_errors = 100000

# Logging
log-error = $DATA_DIR/mysql.err
slow_query_log = 1
slow_query_log_file = $DATA_DIR/mysql-slow.log
long_query_time = 2

# Character
character-set-server = utf8mb4
collation-server = utf8mb4_general_ci

# Networking
skip-name-resolve

# Binary logging
server-id = 1
log-bin = $DATA_DIR/mysql-bin
binlog_format = row
expire_logs_days = 7
sync_binlog = 1
EOF
}

# å‡½æ•°ï¼šé…ç½® systemd
setup_systemd() {
    echo "é…ç½® systemd æœåŠ¡..."
    cat > $SYSTEMD_UNIT_PATH <<EOF
[Unit]
Description=MySQL Server
After=network.target

[Service]
User=$MYSQL_USER
Group=$MYSQL_USER
ExecStart=$INSTALL_DIR/bin/mysqld --defaults-file=$MY_CNF_PATH
LimitNOFILE = 65535
Restart=on-failure
TimeoutSec=900
PrivateTmp=true

[Install]
WantedBy=multi-user.target
EOF

    chmod 644 $SYSTEMD_UNIT_PATH
    systemctl daemon-reexec
    systemctl daemon-reload
    systemctl enable mysqld
    systemctl start mysqld
}

# å‡½æ•°ï¼šè®¾ç½®ç¯å¢ƒå˜é‡
setup_environment() {
    echo "è®¾ç½®ç¯å¢ƒå˜é‡..."
    echo "export PATH=\$PATH:$INSTALL_DIR/bin" > /etc/profile.d/mysql.sh
    source /etc/profile.d/mysql.sh
}

# ä¸»å…¥å£
main() {
    check_existing_mysql
    install_deps
    prepare_env
    check_version_exists
    download_mysql
    build_mysql
    init_mysql
    generate_mycnf
    setup_systemd
    setup_environment

    echo "? MySQL $MYSQL_VERSION å®‰è£…å®Œæˆ"
    echo "?? é…ç½®æ–‡ä»¶ï¼š$MY_CNF_PATH"
    echo "?? å¯åŠ¨æœåŠ¡ï¼šsystemctl start mysqld"
    echo "?? å½“å‰ root æ— å¯†ç ï¼Œå»ºè®®æ‰‹åŠ¨è®¾ç½®ï¼šmysqladmin -u root password 'æ–°å¯†ç '"
}

main "$@"
```

## 1.3ESå®‰è£…è„šæœ¬

### 1.3.1ESå•æœºéƒ¨ç½²

```go
ES_VERSION="8.13.4"
ES_USER="elasticsearch"
INSTALL_DIR="/opt/elasticsearch"
DATA_DIR="/data/elasticsearch"
ES_PORT=9200

# æ£€æŸ¥æ˜¯å¦ä¸º root ç”¨æˆ·
if [ "$EUID" -ne 0 ]; then
  echo "è¯·ä½¿ç”¨ root ç”¨æˆ·æ‰§è¡Œè„šæœ¬"
  exit 1
fi

echo ">>> 1. å®‰è£…å¿…è¦ä¾èµ–..."
yum install -y wget curl tar java-1.8.0-openjdk-devel || \
apt update && apt install -y wget curl tar openjdk-11-jdk

echo ">>> 2. åˆ›å»ºç”¨æˆ·ä¸ç›®å½•..."
useradd -m -s /sbin/nologin $ES_USER
mkdir -p $INSTALL_DIR $DATA_DIR
chown -R $ES_USER:$ES_USER $INSTALL_DIR $DATA_DIR

echo ">>> 3. ä¸‹è½½å¹¶è§£å‹ Elasticsearch $ES_VERSION..."
cd /tmp
wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-$ES_VERSION-linux-x86_64.tar.gz
tar -xzf elasticsearch-$ES_VERSION-linux-x86_64.tar.gz
mv elasticsearch-$ES_VERSION $INSTALL_DIR

chown -R $ES_USER:$ES_USER $INSTALL_DIR

echo ">>> 4. ä¿®æ”¹ elasticsearch.yml é…ç½®..."
cat > $INSTALL_DIR/config/elasticsearch.yml <<EOF
cluster.name: single-node-cluster
node.name: node-1
path.data: $DATA_DIR
path.logs: $INSTALL_DIR/logs
network.host: 0.0.0.0
http.port: $ES_PORT
discovery.type: single-node
xpack.security.enabled: false
EOF

chown $ES_USER:$ES_USER $INSTALL_DIR/config/elasticsearch.yml

echo ">>> 5. åˆ›å»º systemd æœåŠ¡..."
cat > /etc/systemd/system/elasticsearch.service <<EOF
[Unit]
Description=Elasticsearch
Documentation=https://www.elastic.co
Wants=network-online.target
After=network-online.target

[Service]
Type=simple
User=$ES_USER
Group=$ES_USER
ExecStart=$INSTALL_DIR/bin/elasticsearch
Restart=on-failure
LimitNOFILE=65535

[Install]
WantedBy=multi-user.target
EOF

echo ">>> 6. è®¾ç½®å†…æ ¸å‚æ•°..."
# å¯é€‰çš„ä¼˜åŒ–
cat >> /etc/sysctl.conf <<EOF
vm.max_map_count=262144
EOF
sysctl -p

ulimit -n 65536

echo ">>> 7. å¯åŠ¨ Elasticsearch..."
systemctl daemon-reexec
systemctl daemon-reload
systemctl enable elasticsearch
systemctl start elasticsearch

echo ">>> 8. éªŒè¯çŠ¶æ€..."
sleep 5
curl -X GET http://localhost:$ES_PORT

echo "âœ… Elasticsearch $ES_VERSION å®‰è£…å®Œæˆ"
```

## 1.4gitlabéƒ¨ç½²

```shell
#!/bin/bash
set -e

# é…ç½®è®¿é—®åŸŸåæˆ–IP
DOMAIN="gitlab.local"
EXTERNAL_URL="http://$DOMAIN"

echo "å®‰è£… GitLab CEï¼Œè®¿é—®åœ°å€ï¼š$EXTERNAL_URL"

# æ·»åŠ  GitLab å®˜æ–¹ä»“åº“
curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh | bash

# å®‰è£…æœ€æ–°çš„ GitLab CE
EXTERNAL_URL="$EXTERNAL_URL" dnf install -y gitlab-ce

# åˆå§‹åŒ–é…ç½®å¹¶å¯åŠ¨ GitLab
gitlab-ctl reconfigure

echo ""
echo "âœ… GitLab CE å®‰è£…å®Œæˆï¼"
echo "ğŸ”— è®¿é—®åœ°å€ï¼š $EXTERNAL_URL"
echo "è¯·é¦–æ¬¡è®¿é—®è®¾ç½® root å¯†ç "

```

è‡ªç­¾å

```powershell
#!/bin/bash
set -e

# é…ç½®è®¿é—®åŸŸåæˆ–IP
DOMAIN="gitlab.local"
EXTERNAL_URL="https://$DOMAIN"

echo "å®‰è£… GitLab CEï¼Œè®¿é—®åœ°å€ï¼š$EXTERNAL_URL"

# æ·»åŠ  GitLab å®˜æ–¹ä»“åº“
curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh | bash

# å®‰è£…æœ€æ–° GitLab
EXTERNAL_URL="$EXTERNAL_URL" dnf install -y gitlab-ce

# åˆ›å»º SSL è¯ä¹¦ç›®å½•
SSL_DIR="/etc/gitlab/ssl"
mkdir -p "$SSL_DIR"
chmod 700 "$SSL_DIR"

# ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ï¼ˆæœ‰æ•ˆæœŸ10å¹´ï¼‰
openssl req -newkey rsa:4096 -nodes -keyout "$SSL_DIR/$DOMAIN.key" \
  -x509 -days 3650 -out "$SSL_DIR/$DOMAIN.crt" \
  -subj "/C=CN/ST=Local/L=Dev/O=SelfSigned/OU=IT/CN=$DOMAIN"

chmod 600 "$SSL_DIR/$DOMAIN"*

# é…ç½® GitLab ä½¿ç”¨ HTTPS
echo "external_url \"$EXTERNAL_URL\"" > /etc/gitlab/gitlab.rb
echo "nginx['redirect_http_to_https'] = true" >> /etc/gitlab/gitlab.rb
echo "nginx['ssl_certificate'] = \"$SSL_DIR/$DOMAIN.crt\"" >> /etc/gitlab/gitlab.rb
echo "nginx['ssl_certificate_key'] = \"$SSL_DIR/$DOMAIN.key\"" >> /etc/gitlab/gitlab.rb

# åˆå§‹åŒ– GitLab
gitlab-ctl reconfigure

echo ""
echo "âœ… GitLab CE å®‰è£…å®Œæˆï¼ˆå·²å¯ç”¨è‡ªç­¾å HTTPSï¼‰ï¼"
echo "ğŸ” ä½¿ç”¨åœ°å€ï¼šhttps://$DOMAIN"
echo "ğŸ§ª æµè§ˆå™¨è®¿é—®æ—¶å¦‚æç¤ºâ€œè¿æ¥ä¸å®‰å…¨â€ï¼Œè¯·æ‰‹åŠ¨ä¿¡ä»»è‡ªç­¾è¯ä¹¦ã€‚"

```



## 1.5jenkinséƒ¨ç½²

```powershell
127.0.0.1 jenkins.local
```

```powershell
è„šæœ¬1
#!/bin/bash
set -e

DOMAIN="jenkins.local"

# å®‰è£…ä¾èµ–å’Œ Javaï¼ˆJenkins è¿è¡Œä¾èµ– Java 17ï¼‰
dnf install -y java-17-openjdk curl

# æ·»åŠ  Jenkins ä»“åº“
curl -fsSL https://pkg.jenkins.io/redhat-stable/jenkins.io.key | gpg --dearmor -o /etc/pki/rpm-gpg/jenkins.gpg
cat <<EOF > /etc/yum.repos.d/jenkins.repo
[jenkins]
name=Jenkins-stable
baseurl=https://pkg.jenkins.io/redhat-stable
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/jenkins.gpg
EOF

# å®‰è£…æœ€æ–°ç‰ˆæœ¬ Jenkins
dnf install -y jenkins

# å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯
systemctl enable --now jenkins

echo "Jenkins å®‰è£…å®Œæˆï¼Œè®¿é—®ï¼šhttp://$DOMAIN:8080"

```

æŒ‡å®šç‰ˆæœ¬

```powershell
#!/bin/bash
set -e

DOMAIN="jenkins.local"
VERSION="2.426.1"

dnf install -y java-17-openjdk curl

curl -fsSL https://pkg.jenkins.io/redhat-stable/jenkins.io.key | gpg --dearmor -o /etc/pki/rpm-gpg/jenkins.gpg
cat <<EOF > /etc/yum.repos.d/jenkins.repo
[jenkins]
name=Jenkins-stable
baseurl=https://pkg.jenkins.io/redhat-stable
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/jenkins.gpg
EOF

dnf install -y jenkins-$VERSION

systemctl enable --now jenkins

echo "âœ… Jenkins $VERSION å®‰è£…å®Œæˆï¼Œè®¿é—®ï¼šhttp://$DOMAIN:8080"
```

```powershell
#!/bin/bash
set -e

DOMAIN="jenkins.local"
CERT_DIR="/etc/ssl/jenkins"
PORT=8443

dnf install -y java-17-openjdk curl openssl

# æ·»åŠ  Jenkins ä»“åº“
curl -fsSL https://pkg.jenkins.io/redhat-stable/jenkins.io.key | gpg --dearmor -o /etc/pki/rpm-gpg/jenkins.gpg
cat <<EOF > /etc/yum.repos.d/jenkins.repo
[jenkins]
name=Jenkins-stable
baseurl=https://pkg.jenkins.io/redhat-stable
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/jenkins.gpg
EOF

dnf install -y jenkins

# ç”Ÿæˆè‡ªç­¾åè¯ä¹¦
mkdir -p $CERT_DIR
openssl req -newkey rsa:2048 -nodes -keyout $CERT_DIR/jenkins.key \
  -x509 -days 3650 -out $CERT_DIR/jenkins.crt \
  -subj "/C=CN/ST=Dev/L=Lab/O=SelfSigned/OU=IT/CN=$DOMAIN"

chmod 600 $CERT_DIR/jenkins.*

# é…ç½® Jenkins ä½¿ç”¨ HTTPSï¼ˆä¿®æ”¹ Jenkins å¯åŠ¨å‚æ•°ï¼‰
cat <<EOF > /etc/sysconfig/jenkins
JENKINS_PORT="8080"
JENKINS_HTTPS_PORT="$PORT"
JENKINS_HTTPS_KEYSTORE=""
JENKINS_HTTPS_KEY="$CERT_DIR/jenkins.key"
JENKINS_HTTPS_CERT="$CERT_DIR/jenkins.crt"
EOF

# å¯åŠ¨ Jenkins
systemctl daemon-reexec
systemctl enable --now jenkins

echo "âœ… Jenkins å®‰è£…å®Œæˆï¼Œè®¿é—®åœ°å€ï¼šhttps://$DOMAIN:$PORT"
```

