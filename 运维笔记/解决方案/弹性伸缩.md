# 1.k8s弹性伸缩方案

- **Pod 层弹性**：使用 Horizontal Pod Autoscaler（HPA）
- **Node 层弹性**：使用 Cluster Autoscaler + 阿里云 Auto Scaling Group（ASG）
- **指标来源**：CPU/Memory 默认指标（metrics server） + 自定义指标（如 Prometheus + Adapter）

需为 Cluster Autoscaler Pod 绑定 RAM 角色，具备操作 ECS 伸缩组的权限（AliyunECSFullAccess 或自定义策略）



Cluster Autoscaler 会监控 Pending Pod，并自动扩容节点。

## 一、核心原理

- **Cluster Autoscaler（CA）** 是 Kubernetes 官方组件，负责：
  - 监控是否有 **Pending 状态的 Pod**（因资源不足无法调度）
  - 若有，则向云厂商（如阿里云）请求 **扩容节点**
  - 定期检查空闲节点（默认连续 10 分钟无不可驱逐 Pod），自动 **缩容节点**
- **阿里云 ASG（Auto Scaling Group）**：
  - 提供一组同构 ECS 实例的自动扩缩能力
  - CA 通过调用阿里云 API 控制 ASG 的 **期望实例数（Desired Capacity）**

HPA 扩容 Pod → Pod Pending → CA 触发 ASG 扩容节点 → Pod 被调度 → 流量高峰结束 → CA 缩容空闲节点

**通过调度约束，亲和等方案，保证缩容时优先**